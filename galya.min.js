(function($,window,document){function css3(properties){var div=document.createElement("div"),style=div.style,prefixes=["O","ms","Webkit","Moz"],i=prefixes.length,result={};while(i--){!$.isArray(properties)&&(properties=[properties]);$.each(properties,function(key,val){var property=val.slice(0,1).toUpperCase()+val.slice(1);var prefixed=prefixes[i]+property;var tmp={};if(prefixed in style){tmp[val]=prefixed;$.extend(result,tmp)}})}div=null;return result}$.fn.galya=function(args){var settings={autoplay:false,fadeSpeed:500,scrollSpeed:250,slideWidth:725,slideHeight:"auto",slideCrop:false,slideCropBy:["bottom","right"],headingLevel:4,captionContentTag:"p",thumbnailWidth:110,thumbnailHeight:"auto"};args&&$.extend(settings,args);this.each(function(){new Galya($(this),settings).initialize()});return this};function Galya($container,settings){var classes={slidesContainer:"galya-slides",slide:"galya-slide",slideImage:"galya-image",slideCaption:"galya-caption",slideHeading:"galya-caption-heading",slideText:"galya-caption-content",thumbsContainer:"galya-thumbnails",thumbsScrollable:"galya-thumbnails-scrollable",thumbImage:"galya-thumbnail",prev:"galya-prev",active:"active"};var $objects={};var props={};this.initialize=function(){$objects.container=$container;$objects.sourceImages=$("> img",$container);renderSlidesList();renderThumbnailsList();renderNavControls();$objects.slidesContainer=$("."+classes.slidesContainer,$container);$objects.slides=$("."+classes.slide,$container);$objects.images=$("."+classes.slideImage,$container);$objects.thumbsContainer=$("."+classes.thumbsContainer,$container);$objects.thumbsScrollable=$("."+classes.thumbsScrollable,$container);$objects.thumbs=$("."+classes.thumbImage,$container);$objects.prev=$("."+classes.prev,$container);$objects.container.width(settings.slideWidth);$objects.thumbs.width(settings.thumbnailWidth);var containerWidth=$objects.container.width();var thumbWidth=getThumbWidth();props.visibleThumbs=Math.floor(containerWidth/thumbWidth);props.initialThumbsOffset=thumbWidth*(props.visibleThumbs-1);props.currentThumbsOffset=0;activateStage(0);$objects.images.first().load(function(){var imageHeight=$(this).height();$objects.slidesContainer.height(imageHeight);$objects.thumbsContainer.height($objects.thumbs.parent().height());$container.height(imageHeight+$objects.thumbsContainer.height());$objects.prev.height(imageHeight);$container.triggerHandler("galya.loaded")});$objects.images.on("click",function(ev){if($objects.thumbsScrollable.is(":animated"))return false;activateStage("next")});$objects.thumbs.on("click",function(){var $this=$(this);if($this.hasClass(classes.active))return false;activateStage($this.index())});$objects.prev.on("click",function(){if($objects.thumbsScrollable.is(":animated"))return false;activateStage("prev")})};function getImageAttrs($image){return{src:$image.attr("src"),alt:$image.attr("alt")||"",title:$image.data("title")||"",content:$image.data("content")||""}}function getThumbWidth(){return $objects.thumbs.width()+parseInt($objects.thumbs.last().css("margin-left"))}function renderSlidesList(){var html="";$objects.sourceImages.each(function(idx,image){var $image=$(image);var attrs=getImageAttrs($image);var figureHTML='<figure class="'+classes.slide+'">'+'<img class="'+classes.slideImage+'" src="'+attrs.src+'" alt="'+attrs.alt+'">';if(attrs.alt||attrs.content){figureHTML+='<figcaption class="'+classes.slideCaption+'">';if(attrs.title){figureHTML+="<h"+settings.headingLevel+' class="'+classes.slideHeading+'">'+attrs.title+"</h"+settings.headingLevel+">"}var content=attrs.content?attrs.content:attrs.alt;content="<"+settings.captionContentTag+' class="'+classes.slideText+'">'+content+"</"+settings.captionContentTag+">";figureHTML+=content+"</figcaption>"}html+=figureHTML+"</figure>"});$objects.container.html('<div class="'+classes.slidesContainer+'">'+html+"</div>")}function renderThumbnailsList(){var html="";$objects.sourceImages.each(function(index,image){var $image=$(image);var attrs=getImageAttrs($image);html+='<img class="'+classes.thumbImage+'" src="'+attrs.src+'" alt="'+attrs.alt+'">'});$objects.container.append('<div class="'+classes.thumbsContainer+'">'+'<div class="'+classes.thumbsScrollable+'">'+html+"</div></div>")}function renderNavControls(){$objects.container.append('<div class="'+classes.prev+'"><span>&#x276e;</span></div>')}function getStageByIndex(index){return{slide:getElementByIndex($objects.slides,index),thumb:getElementByIndex($objects.thumbs,index)}}function activateStage(direction){props.stage=getStageByIndex(getStageIndexByDirection(direction));props.stageIndex=props.stage.slide.index();$container.triggerHandler("stage.activating",[props.stageIndex,props.stage]);props.oldStageIndex=deactivateStage();activateSlide(props.stage.slide);activateThumb(props.stage.thumb);scrollThumbs(direction);$container.triggerHandler("stage.activated",[props.stageIndex,props.stage])}function activateSlide($slide){$container.triggerHandler("slide.activating",[props.stageIndex,$slide]);$slide.fadeIn(settings.fadeSpeed,function(){$(this).addClass(classes.active);$container.triggerHandler("slide.activated",[props.stageIndex,$slide])})}function activateThumb($thumb){$container.triggerHandler("thumb.activating",[props.stageIndex,$thumb]);$thumb.addClass(classes.active);$container.triggerHandler("thumb.activated",[props.stageIndex,$thumb])}function deactivateStage(){$container.triggerHandler("stage.deactivating",[props.stageIndex,props.stage]);var index=deactivateSlide();deactivateThumb();$container.triggerHandler("stage.deactivated",[props.stageIndex,props.stage]);return index}function deactivateSlide(){var $element=getActiveElement($objects.slides);var index=$element.index();$container.triggerHandler("slide.deactivating",[index,$element]);$element.fadeOut(settings.fadeSpeed,function(){$(this).removeClass(classes.active);$container.triggerHandler("slide.deactivated",[index,$element])});return index}function deactivateThumb(){var $element=getActiveElement($objects.thumbs);var index=$element.index();$container.triggerHandler("thumb.deactivating",[index,$element]);$element.removeClass(classes.active);$container.triggerHandler("slide.deactivated",[index,$element]);return index}function scrollThumbs(direction){var endReached=props.stageIndex==0&&props.oldStageIndex==$objects.slides.length-1;var startReached=props.oldStageIndex==0&&props.stageIndex==$objects.slides.length-1;var currentIndex=direction=="prev"?props.oldStageIndex:props.stageIndex;var movingForward=props.stageIndex>props.oldStageIndex;var directionIsInt=typeof direction==="number"&&direction%1===0;var isFirstOrLastVisible=function(index){return index!=0&&index%(props.visibleThumbs-1)==0};var partiallyVisible=isFirstOrLastVisible(currentIndex-1);if(endReached){props.currentThumbsOffset=0}else if(startReached){props.currentThumbsOffset=-(props.initialThumbsOffset*Math.floor($objects.slides.length/props.visibleThumbs))}else if(isFirstOrLastVisible(currentIndex)){switch(direction){case"prev":props.currentThumbsOffset+=props.initialThumbsOffset;break;case"next":props.currentThumbsOffset-=props.initialThumbsOffset;break;default:if(movingForward)props.currentThumbsOffset-=props.initialThumbsOffset;else props.currentThumbsOffset+=props.initialThumbsOffset;break}}else if(partiallyVisible&&directionIsInt&&movingForward){props.currentThumbsOffset-=props.initialThumbsOffset}props.currentThumbsOffset!=props.initialThumbsOffset&&performScrollThumbs()}function performScrollThumbs(coord,offset){var cool=css3(["transition","transform"]);!coord&&(coord="x");!offset&&(offset=props.currentThumbsOffset);if(cool){var style=$objects.thumbsScrollable.get(0).style;style[cool.transition]="all "+settings.scrollSpeed+"ms linear";switch(coord){case"x":style[cool.transform]="translate3d("+offset+"px, 0, 0)";break;case"y":style[cool.transform]="translate3d(0, "+offset+"px, 0)";break;case"z":style[cool.transform]="translate3d(0, 0, "+offset+"px)";break}}else{coord=coord=="x"?"left":"top";var animation={};animation[coord]=props.currentThumbsOffset;$objects.thumbsScrollable.animate(animation,settings.scrollSpeed)}}function getActiveElement($collection){return $collection.filter(function(idx,el){return $(el).hasClass(classes.active)}).first()}function getElementByIndex($collection,index){return $collection.filter(function(idx,el){return $(el).index()==index}).first()}function getStageIndexByDirection(direction){var activeIndex=getActiveElement($objects.slides).index();switch(direction){case"prev":--activeIndex;break;case"next":++activeIndex;break;default:activeIndex=direction;break}var min=0;var max=$objects.slides.length-1;if(activeIndex>max){activeIndex=min}else if(activeIndex<min){activeIndex=max}return activeIndex}}})(jQuery,window,document);